plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.3.72'
    id 'com.google.protobuf' version '0.8.12'
}

group 'org.vitrivr'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

compileKotlin {
    kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
    kotlinOptions.jvmTarget = "1.8"
}

sourceSets {
    main {
        proto {
            srcDirs += "$projectDir/cottontaildb-proto/src/main/protobuf"
        }
        kotlin {
            srcDirs += "$projectDir/build/generated/source/proto/main/java"
        }
    }
}

protobuf {
    generatedFilesBaseDir = "$projectDir/build/generated/source/proto"
    plugins {
        grpc {
            artifact = 'io.grpc:protoc-gen-grpc-java:1.29.0'
        }
    }
    protoc {
        artifact = 'com.google.protobuf:protoc:3.12.3'
    }
    generateProtoTasks {
        all()*.plugins { grpc {
            outputSubDir = 'java'
        }}
    }
}

task runKotlinExample(type: JavaExec) {
    main = 'org.vitrivr.cottontail.examples.Examples'
    classpath = sourceSets.main.runtimeClasspath
}

dependencies {
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
    compile group: 'org.jetbrains.kotlin', name: 'kotlin-script-runtime', version: '1.3.61'

    /////// gRPC & Protobuf
    compile group: 'javax.annotation', name: 'javax.annotation-api', version: '1.2'
    compile group: 'com.google.protobuf', name: 'protobuf-java', version: '3.12.2'
    compile group: 'io.grpc', name: 'grpc-all', version: '1.29.0'
}
